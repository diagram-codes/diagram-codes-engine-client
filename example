!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e=e||self).DiagramEngine=r()}(this,function(){var e=require("uuid").v4,r=function(){function r(){}return r.setEnginePath=function(e){r.enginePath=e},r.setErrorHandler=function(e){r.globalErrorHandler=e},r.renderDiagram=function(e){var n=e.container,t=e.type,a=e.code,i=e.theme;return new Promise(function(e,d){if(!r.enginePath)throw new Error("Diagram Engine path not set, use DiagramEngine.setEnginePath('path-to-engine')");var o="string"==typeof n?document.querySelector(n):n;if(!o)throw new Error("Could not find container DOM element");var s=o.querySelector("iframe[diagram-renderer]");if(!s)throw new Error("Please call DiagramEngine.init(container) to initialize the engine first");var g=ifram.getAttribute("data-diagram-id");if(!g)throw new Error("No data-diagram-id found on iframe");r.addMessageHandler("diagram-render-finished",s,function(r){var n=r.data.size;if(!n)throw new Error("Diagram size not returned");s.style.width=n.width+"px",s.style.height=n.height+"px",e()},!0),s.contentWindow.postMessage({type:"render-diagram",data:{id:g,type:t,code:a,theme:i}},"*")})},r.init=function(n){try{return Promise.resolve(new Promise(function(t){var a=n.querySelector("iframe[diagram-renderer]");a&&a.remove();var i=e();n.innerHTML="",(a=document.createElement("iframe")).setAttribute("data-diagram-id",i),a.style.border="none",a.setAttribute("diagram-renderer",""),a.setAttribute("ready","false"),a.src=r.enginePath,r.addMessageHandler("diagram-render-engine-ready",a,function(e){e.data&&"diagram-render-engine-ready"===e.data.type&&e.data.id===i&&(console.log("Diagram instance initialized:",i),a.setAttribute("ready","true"),t({iframe:a,instanceId:i}))},!0),n.appendChild(a)}))}catch(e){return Promise.reject(e)}},r.getSvg=function(e){var n=e.container;return new Promise(function(e){var t=n.querySelector("iframe[diagram-renderer]");if(!t)throw new Error("Please call DiagramEngine.init(container) to initialize the engine first");r.addMessageHandler("rendered-svg-response",t,function(r){console.log("getSvg handler ev:",r),e(r.data)},!0),t.contentWindow.postMessage({type:"request-rendered-svg"},"*")})},r.addMessageHandler=function(e,n,t,a){void 0===a&&(a=!1),r.handlers.push({eventName:e,iframe:n,cb:t,once:a})},r}();return window.addEventListener("message",function(e){if(e.data&&e.data.type){var n=r.handlers.find(function(r){return r.eventName===e.data.type&&r.iframe.contentWindow===e.source});if(n&&(n.cb(e),n.once)){var t=r.handlers.indexOf(n);r.handlers.splice(t,1)}e.data&&"diagram-render-error"===e.data.type&&r.globalErrorHandler&&r.globalErrorHandler(e.data)}}),r.handlers=[],r});
//# sourceMappingURL=diagram-codes-engine-client.umd.js.map
