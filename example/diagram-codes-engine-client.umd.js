!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):(e=e||self).DiagramEngine=r()}(this,function(){var e=function(){function e(){}return e.setEnginePath=function(r){e.enginePath=r},e.setErrorHandler=function(r){e.globalErrorHandler=r},e.renderDiagram=function(r){var n=r.container,t=r.type,a=r.code,i=r.theme;try{if(!e.enginePath)throw new Error("Diagram Engine path not set, use DiagramEngine.setEnginePath('path-to-engine')");if(!("string"==typeof n?document.querySelector(n):n))throw new Error("Could not find container DOM element");var o=n.querySelector("iframe[diagram-renderer]");if(!o)throw new Error("Please call DiagramEngine.init(container) to initialize the engine first");return o.contentWindow.postMessage({type:"render-diagram",data:{type:t,code:a,theme:i}},"*"),Promise.resolve()}catch(e){return Promise.reject(e)}},e.init=function(r){try{return Promise.resolve(new Promise(function(n){var t=r.querySelector("iframe[diagram-renderer]");t&&t.remove(),r.innerHTML="",(t=document.createElement("iframe")).style.width="100%",t.style.height="100%",t.style.border="none",t.style.minWidth="400px",t.style.minHeight="400px",t.setAttribute("diagram-renderer",""),t.setAttribute("ready","false"),t.src=e.enginePath,e.addMessageHandler("diagram-render-engine-ready",t,function(e){e.data&&"diagram-render-engine-ready"===e.data.type&&(t.setAttribute("ready","true"),n(t))},!0),r.appendChild(t)}))}catch(e){return Promise.reject(e)}},e.getSvg=function(r){var n=r.container;return new Promise(function(r){var t=n.querySelector("iframe[diagram-renderer]");if(!t)throw new Error("Please call DiagramEngine.init(container) to initialize the engine first");e.addMessageHandler("diagram-render-engine-ready",t,function(e){console.log("getSvg handler ev:",e),r(e.data)},!0),t.contentWindow.postMessage({type:"request-rendered-svg"},"*")})},e.addMessageHandler=function(r,n,t,a){e.handlers.push({eventName:r,iframe:n,cb:t})},e}();return window.addEventListener("message",function(r){if(r.data&&r.data.type){var n=e.handlers.find(function(e){return e.eventName===r.data.type&&e.iframe.contentWindow===r.source});if(n&&(n.cb(r),n.once)){var t=e.handlers.indexOf(n);e.handlers.splice(t,1)}r.data&&"diagram-render-error"===r.data.type&&e.globalErrorHandler&&e.globalErrorHandler(r.data)}}),e.handlers=[],e});
//# sourceMappingURL=diagram-codes-engine-client.umd.js.map
